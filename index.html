<link href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/github-fork-ribbon-css/0.2.3/gh-fork-ribbon.min.css"/>
<script src="https://unpkg.com/json5@^2.0.0/dist/index.min.js"></script>
<style>
  textarea.form-control {
    width: 100%;
    height: 200px;
  }

  .container {
    width: 1000px;
    height: 100%;
    margin: 50px auto;
  }

  .btns {
    margin: 20px 0;
  }

  .btn {
    margin-right: 20px;
  }

  samp {
    display: block;
    overflow: hidden;
    white-space: pre-wrap;
  }

  .github-fork-ribbon:before {
    background-color: #767b96;
  }
</style>
<div class="container">
  <a class="github-fork-ribbon" href="https://github.com/cakeinpanic/curl-param-extractor" data-ribbon="Fork me on GitHub" title="Fork me on GitHub">Fork me on GitHub</a>

  <h1>cURL params extractor</h1>
  <label for="text">Enter cURL <a href="https://ec.haxx.se/usingcurl/usingcurl-copyas" target="_blank">copied</a> from browser here</label>
  <textarea class="form-control" name="text" id="text"></textarea>
  <div class="btns">
    <button id="btn" class="btn btn-primary">Get cURL</button>
    <button id="btn-copy" class="btn btn-secondary">Copy</button>
    <button id="btn-copy-request" class="btn btn-secondary">Copy request url</button>
  </div>
  <samp id="request-url"></samp>
  <samp id="paramsSamp"></samp>
</div>
<script>
  const ta = document.getElementById('text')
  const btn = document.getElementById('btn')
  const btnCopy = document.getElementById('btn-copy')
  const btnCopyRequest = document.getElementById('btn-copy-request')
  const paramsSamp = document.getElementById('paramsSamp')
  const requestUrlSamp = document.getElementById('request-url')

  btnCopy.style.display = 'none'
  btnCopyRequest.style.display = 'none'
  btn.addEventListener('click', convertcURL)
  btnCopy.addEventListener('click', () => copy(paramsSamp.innerHTML))
  btnCopyRequest.addEventListener('click', () => copy(requestUrlSamp.innerHTML))

  function convertcURL () {
    const request = ta.value
    const params = decodeParams(request)
    const url = decodeUrl(request)

    btnCopy.style.display = 'inline-block'
    btnCopyRequest.style.display = 'inline-block'
    paramsSamp.innerHTML = params
    if (url) {
      requestUrlSamp.innerHTML = `URL: ${url}\n\n`
    }
  }

  function decodeUrl (str) {
    try {
      const url = /curl '(.+)'/.exec(str)[1]
      return url
    } catch (e) {
      return ''
    }
  }
  function decodeParams (str) {
    try {
      const requestData = str.split('--data-binary')[1].split('--compressed')[0]
      const firstQuoteIndex = requestData.indexOf('\'')
      const lastQuoteIndex = requestData.lastIndexOf('\'')

      const escapedQuoteRg = /\\(")/ig
      const param = requestData.substring(firstQuoteIndex + 1, lastQuoteIndex).replace(escapedQuoteRg, '$1')

      const beautifulJson = JSON.stringify(JSON5.parse(param), null, 2)
      return beautifulJson
    } catch (e) {
      console.error(e)
      return 'Invalid curl'
    }
  }

  function copy (str) {
    const el = document.createElement('textarea')
    el.value = str
    document.body.appendChild(el)
    el.select()
    document.execCommand('copy')
    document.body.removeChild(el)
  }
</script>